@model IEnumerable<CV_siten.Data.Models.Person>

@{
    ViewData["Title"] = "Startsida";
}

<div class="background" style="padding: 20px; min-height: 100vh;">

    @* --- Välkomstområde --- *@
    <div class="welcome-area mb-4" style="background-color: white; border-radius: 12px; padding: 30px; border-left: 8px solid #002d5a; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
        <h2 style="color: #002d5a; font-weight: bold;">Välkommen till CV-siten</h2>
        <p style="color: #444; font-size: 1.1rem; margin-bottom: 0;">
            Här kan du hitta kompetenta utvecklare och spännande projekt.
        </p>
    </div>

    @* --- Senaste projektet --- *@
    <div class="project-highlight-area mb-5" style="background-color: #f8f9fa; border-radius: 12px; padding: 25px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
        <h4 style="color: #002d5a; border-bottom: 2px solid #dee2e6; padding-bottom: 10px; margin-bottom: 20px;">
            Senaste projektet
        </h4>

        @if (ViewBag.SenasteProjekt != null)
        {
            <div style="background-color: white; padding: 20px; border-radius: 8px; border: 1px solid #dee2e6;">
                <h5 style="color: #0056b3; font-weight: bold;">@ViewBag.SenasteProjekt.ProjectName</h5>
                <p style="color: #555;">@ViewBag.SenasteProjekt.Description</p>

                <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 15px;">
                    <small class="text-muted">
                        Startade: @ViewBag.SenasteProjekt.StartDate.ToString("yyyy-MM-dd")
                    </small>

                    <a asp-controller="Project" asp-action="ProjectDetails" asp-route-id="@ViewBag.SenasteProjekt.Id"
                       class="btn btn-sm btn-outline-primary">
                        Läs mer
                    </a>
                </div>
            </div>
        }
        else
        {
            <p class="text-center text-muted">Inga projekt registrerade ännu.</p>
        }
    </div>

    @* --- Visa profiler ENDAST om användaren är inloggad --- *@
    @if (User.Identity.IsAuthenticated)
    {
        <h4 class="text-white mb-4" style="font-weight: 300; letter-spacing: 1px;">
            @ViewBag.SectionTitle
        </h4>

        <div class="profile-grid-container"
             style="display: grid; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); gap: 25px;">

            @foreach (var person in Model)
            {
                <div class="profile-card"
                     style="background-color: #ffffff; border-radius: 15px; overflow: hidden;
                                                    transition: all 0.3s ease; box-shadow: 0 10px 20px rgba(0,0,0,0.2); border: none;">

                    <div style="height: 10px; background-color: #0056b3;"></div>

                    <div class="p-4 text-center">

                        @* --- Profilbild --- *@
                        @if (!string.IsNullOrEmpty(person.ImageUrl))
                        {
                            <img src="~/images/ProfilePicture/@person.ImageUrl"
                                 style="width: 100px; height: 100px; border-radius: 50%; object-fit: cover;
                                                                            border: 4px solid #f0f2f5; margin-bottom: 15px;"
                                 alt="Profilbild för @person.FirstName" />
                        }
                        else
                        {
                            <div style="width: 100px; height: 100px; background: #f0f2f5; border-radius: 50%;
                                                                            margin: 0 auto 15px auto; line-height: 100px; color: #adb5bd; font-size: 2rem;">
                                <i class="fas fa-user"></i>
                            </div>
                        }

                        <h5 style="color: #002d5a; font-weight: bold; margin-bottom: 5px;">
                            @person.FirstName @person.LastName
                        </h5>

                        <p style="color: #0056b3; font-size: 0.9rem; font-weight: 500; margin-bottom: 15px;">
                            @person.JobTitle
                        </p>

                        @* --- Matchningsprocent (tillagd) --- *@
                        @if (ViewBag.MatchData != null && ViewBag.MatchData.ContainsKey(person.Id))
                        {
                            <p style="font-weight: 600; margin-bottom: 10px;">
                                Matchning: @ViewBag.MatchData[person.Id]%
                            </p>
                        }

                    <div style="background: #f8f9fa; border-radius: 8px; padding: 10px;
                                                margin-bottom: 20px; min-height: 60px;">
                        <p class="text-muted small mb-0"
                           style="display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;">
                            @(string.IsNullOrEmpty(person.Description)
                                                    ? "Ingen beskrivning tillgänglig."
                                                    : person.Description)
                            </p>
                        </div>

                        <a asp-controller="Person" asp-action="Profile" asp-route-id="@person.Id"
                           class="btn btn-primary w-100"
                           style="background-color: #002d5a; border: none; border-radius: 8px; padding: 10px; font-weight: 500;">
                            Visa profil
                        </a>

                    </div>
                </div>
            }
        </div>
    }
</div>

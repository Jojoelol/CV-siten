@model IEnumerable<CV_siten.Data.Models.Project>

<div class="yellow-box welcome-area" style="max-width: 1200px; margin: 20px auto; padding: 30px;">
    <h2 style="color: #002d5a;"><i class="fas fa-project-diagram"></i> Gå med i projekt</h2>
    <p class="text-muted">Hitta projekt där din kompetens behövs.</p>
    <hr />

    <div class="projects-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px;">
        @foreach (var project in Model)
        {
            <div class="project-card" style="background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 10px rgba(0,0,0,0.08); display: flex; flex-direction: column; min-height: 420px; border: 1px solid #eee;">

                <div class="project-card-image" style="width: 100%; height: 160px; background-color: #f0f2f5; display: flex; justify-content: center; align-items: center;">
                    @if (!string.IsNullOrEmpty(project.ImageUrl))
                    {
                        <img src="@Url.Content("~/images/projects/" + project.ImageUrl)" alt="@project.ProjectName" style="width: 100%; height: 100%; object-fit: cover;" />
                    }
                    else
                    {
                        <i class="fas fa-project-diagram" style="font-size: 3rem; color: #cbd5e0;"></i>
                    }
                </div>

                <div style="padding: 20px; flex-grow: 1; display: flex; flex-direction: column;">
                    <div style="margin-bottom: 15px; border-bottom: 1px solid #f0f2f5; padding-bottom: 10px;">
                        <span style="font-weight: 800; display: block; color: #002d5a; font-size: 1.2rem;">@project.ProjectName</span>
                        <span style="font-size: 0.85rem; color: #3498db; font-weight: 700; text-transform: uppercase;">
                            <i class="fas fa-user-edit"></i> Ägare: @project.Owner?.FirstName @project.Owner?.LastName
                        </span>
                    </div>

                    @* DETALJER *@
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; font-size: 0.8rem; color: #4a5568; margin-bottom: 15px;">
                        <div><i class="fas fa-layer-group"></i> <strong>Typ:</strong> @(project.Type ?? "Webb")</div>
                        <div><i class="fas fa-circle" style="color: @(project.Status == "Aktivt" ? "#48bb78" : "#a0aec0"); font-size: 0.6rem;"></i> <strong>Status:</strong> @(project.Status ?? "Aktivt")</div>
                        <div><i class="fas fa-calendar-alt"></i> <strong>Start:</strong> @project.StartDate.ToString("yyyy-MM-dd")</div>
                        <div><i class="fas fa-calendar-check"></i> <strong>Slut:</strong> @(project.EndDate.HasValue? project.EndDate.Value.ToString("yyyy-MM-dd") : "Pågående")</div>
                    </div>

                    @* FOTTER MED DELTAGARE OCH KNAPP *@
                    <div style="margin-top: auto; padding-top: 15px; display: flex; align-items: center; justify-content: space-between; border-top: 1px solid #f0f2f5;">
                        <div style="background: #ebf5ff; padding: 4px 10px; border-radius: 20px; color: #2b6cb0; font-weight: 600; font-size: 0.75rem;">
                            <i class="fas fa-users"></i> @(project.PersonProjects?.Count ?? 0)
                        </div>
                        <button type="button" class="btn-action btn-primary btn-small" style="width: auto; padding: 5px 15px;"
                                onclick="showJoinPopup(@project.Id, '@project.ProjectName')">
                            Gå med
                        </button>
                    </div>
                </div>
            </div>
        }
    </div>
</div>


<script>
    function showJoinPopup(projectId, projectName) {
        // Sätt värdena i modalen
        document.getElementById('modalProjectId').value = projectId;
        document.getElementById('modalProjectText').innerText = "Gå med i: " + projectName;

        // Öppna modalen (Bootstrap 5 syntax)
        var myModal = new bootstrap.Modal(document.getElementById('joinRoleModal'));
        myModal.show();
    }
</script>